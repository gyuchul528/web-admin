<!DOCTYPE html>
<html lang="ja">
<head>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理画面</title>
</head>
<body>
    <div class="head clearfix">
        <div class="headlogo left" id="headnav">
            <h2><a href="#">管理画面</a></h2>
        </div>
        <ul class="headnav left">
            <li id="menu_0" class="current-menu">
                <a href="#"><img src="img/menu.png" alt="菜单管理">菜单管理</a>
            </li>
            <li id="menu_1">
                <a href="#"><img src="img/module.png" alt="模块管理">模块管理</a>
            </li>
            <li id="menu_2">
                <a href="#"><img src="img/setting.png" alt="系统设置">系统设置</a>
            </li>
            <li id="menu_3">
                <a href="#"><img src="img/expand.png" alt="扩展管理">扩展管理</a>
            </li>
        </ul>
        <ul class="headlink right clearfix">
            <li id="link_0">
                <a href="#"><img src="img/admin.png" alt="admin" class="nav-icon"> Hello,admin</a>
            </li>
            <li id="link_1">
                <a href="#"><img src="img/hide.png" alt="隐藏菜单" class="nav-icon"><span>隐藏菜单</span></a>
            </li>   
            <li id="link_2">
                <a href="#"><img src="img/home.png" alt="首页" class="nav-icon">首页</a>
            </li>
            <li id="link_3">
                <a href="#"><img src="img/help.png" alt="帮助" class="nav-icon">帮助</a>
            </li>
            <li id="link_4">
                <a href="#"><img src="img/exit.png" alt="退出" class="nav-icon">退出</a>
            </li>
        </ul>
    </div>

    <div class="leftmenu">
        <div class="menu-section">
            <div class="menu-header">
                栏目管理
                <span class="toggle-icon">▼</span>
            </div>
            <div class="menu-content">
                <a href="/admin/category/list" target="main">栏目列表</a>
            </div>
        </div>

        <div class="menu-section">
            <div class="menu-header">
                内容管理
                <span class="toggle-icon">▼</span>
            </div>
            <div class="menu-content">
                <% 
                // 補助関数：インデントスペース取得
                function getIndent(level) {
                    return '　'.repeat(level);
                }

                // 補助関数：再帰的にカテゴリーを表示
                function renderCategories(categories, parentId = 0, level = 0) {
                    categories.filter(cat => cat.parent_id == parentId).forEach(function(category) { 
                %>
                    <a href="/admin/content/<%= category.id %>/list" target="main" style="padding-left: <%= level * 20 %>px">
                        <%= level > 0 ? '├--' : '' %>
                        <%= category.name %>
                    </a>
                <%
                        // 子カテゴリーを再帰的に表示
                        renderCategories(categories, category.id, level + 1);
                    });
                }
                %>
                
                <% renderCategories(categories); %>
            </div>
        </div>

        <div class="menu-section">
            <div class="menu-header">
                快捷面板
                <span class="toggle-icon">▼</span>
            </div>
            <div class="menu-content">
                <a href="javascript:;">广告管理</a>
                <a href="javascript:;">公司管理</a>
                <a href="javascript:;">友情链接</a>
                <a href="javascript:;">留言管理</a>
                <a href="javascript:;">评论管理</a>
                <a href="javascript:;">清楚系统缓存</a>
            </div>
        </div>
        <div id="leftmenu_1" style="display: none;">
            <div class="menu-section">
                <div class="menu-header">
                    内置模块
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="menu-content">
                    <a href="javascript:;">自由模块管理</a>
                    <a href="javascript:;">广告管理</a>
                    <a href="javascript:;">专题管理</a>
                    <a href="javascript:;">公告管理</a>
                    <a href="javascript:;">友情链接</a>
                    <a href="javascript:;">留言本管理</a>
                    <a href="javascript:;">评论管理</a>
                </div>
            </div>
            
            <div class="menu-section">
                <div class="menu-header">
                    其它模块
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="menu-content">
                </div>
            </div>
        </div>

        <div id="leftmenu_2" style="display: none;">
            <div class="menu-section">
                <div class="menu-header">
                    系统设置
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="menu-content">
                    <a href="javascript:;">网站设置</a>
                    <a href="javascript:;">伪静态缓存设置</a>
                    <a href="javascript:;">在线客服设置</a>
                    <a href="javascript:;">清除系统缓存</a>
                </div>
            </div>

            <div class="menu-section">
                <div class="menu-header">
                    静态缓存
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="menu-content">
                    <a href="javascript:;">一键更新全站</a>
                    <a href="javascript:;">更新首页</a>
                    <a href="javascript:;">更新栏目</a>
                    <a href="javascript:;">更新文档</a>
                    <a href="javascript:;">更新专题</a>
                </div>
            </div>

            <div class="menu-section">
                <div class="menu-header">
                    会员管理
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="menu-content">
                    <a href="javascript:;">会员管理</a>
                    <a href="javascript:;">会员组管理</a>
                </div>
            </div>

            <div class="menu-section">
                <div class="menu-header">
                    管理员管理
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="menu-content">
                    <a href="javascript:;">系统用户管理</a>
                    <a href="javascript:;">用户组管理</a>
                    <a href="javascript:;">节点列表</a>
                </div>
            </div>
        </div>

        <div id="leftmenu_3" style="display: none;">
            <div class="menu-section">
                <div class="menu-header">
                    扩展管理
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="menu-content">
                    <a href="javascript:;">模型管理</a>
                    <a href="javascript:;">菜单管理</a>
                    <a href="javascript:;">数据层管理</a>
                    <a href="javascript:;">联动管理</a>
                    <a href="javascript:;">区块管理</a>
                    <a href="javascript:;">数据元管理</a>
                    <a href="javascript:;">已传文件管理</a>
                </div>
            </div>

            <div class="menu-section">
                <div class="menu-header">
                    我的账户
                    <span class="toggle-icon">▼</span>
                </div>
                <div class="menu-content">
                    <a href="javascript:;">修改我的信息</a>
                    <a href="javascript:;">修改密码</a>
                </div>
            </div>
        </div>

    </div>
    
    <div class="right-main">
        <div class="right-content">
            <iframe id="main" name="main" frameborder="0" scrolling="yes" src="main.html">
                
            </iframe>
        </div>
    </div>
    <!-- javascript -->
    <script type="text/javascript" src="js/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="js/script.js"></script>
    <script type="text/javascript">
        $(function(){
            // 阻止事件冒泡并优化菜单点击处理
            $('.menu-section .menu-header').off('click').on('click', function(e) {
                e.stopPropagation(); // 阻止事件冒泡
                const $content = $(this).next('.menu-content');
                const $icon = $(this).find('.toggle-icon');
                
                // 切换当前菜单的展开/收起状态
                $content.slideToggle('fast');
                $icon.toggleClass('rotated');
            });

            // 初始化菜单状态
            $('.menu-section').each(function() {
                const $content = $(this).find('.menu-content');
                const $icon = $(this).find('.toggle-icon');
                if ($content.is(':visible')) {
                    $icon.addClass('rotated');
                }
            });

            // メニュー切り替えの処理
            $(".headnav li").click(function(){
                $(this).addClass("current-menu").siblings().removeClass("current-menu");
                
                var menuId = $(this).attr('id');
                var index = menuId.split('_')[1];
                
                $("[id^='leftmenu_']").hide();
                
                if (index === '0') {
                    $(".leftmenu > .menu-section").show();
                } else {
                    $(".leftmenu > .menu-section").hide();
                    $("#leftmenu_" + index).show();
                }
            });

            // 隐藏菜单ボタンのクリック処理
            $("#link_1").click(function(e){
                e.preventDefault();
                $(".leftmenu").toggle();
                
                // アイコンとテキストの切り替え
                var $img = $(this).find('img');
                var $span = $(this).find('span');
                
                if ($(".leftmenu").is(":visible")) {
                    $img.attr('src', 'img/hide.png').attr('alt', '隐藏菜单');
                    $span.text('隐藏菜单');
                    $('body').addClass('showleftmenu').removeClass('hideleftmenu');
                } else {
                    $img.attr('src', 'img/show_menu.png').attr('alt', '显示菜单');
                    $span.text('显示菜单');
                    $('body').addClass('hideleftmenu').removeClass('showleftmenu');
                }
            });
        });
    </script>
</body>
</html>
