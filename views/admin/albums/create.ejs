<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新規アルバム作成</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="card shadow-sm">
            <div class="card-body">
                <h1 class="card-title h3 mb-4 pb-2 border-bottom">新規アルバム作成</h1>

                <form id="albumForm">
                    <div class="mb-3">
                        <label class="form-label">アルバム名 <span class="text-danger">*</span></label>
                        <input type="text" name="name" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">説明</label>
                        <textarea name="description" class="form-control" rows="3"></textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">公開設定</label>
                        <select name="privacy_level" class="form-select">
                            <option value="1">公開</option>
                            <option value="2">限定公開</option>
                            <option value="3">非公開</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">表示順</label>
                        <input type="number" name="sort_order" class="form-control" value="0">
                        <div class="form-text">数字が小さいほど上に表示されます</div>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">作成</button>
                        <button type="button" onclick="history.back()" class="btn btn-secondary">戻る</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.getElementById('albumForm').onsubmit = async function(e) {
            e.preventDefault();

            // 必須項目のチェック
            if (!this.name.value.trim()) {
                alert('アルバム名を入力してください');
                return;
            }

            try {
                const response = await fetch('/admin/albums/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: this.name.value.trim(),
                        description: this.description.value.trim(),
                        privacy_level: this.privacy_level.value,
                        sort_order: this.sort_order.value
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || '作成に失敗しました');
                }

                const result = await response.json();
                if (result.success) {
                    alert('アルバムを作成しました');
                    // 写真一覧画面に戻る
                    const urlParams = new URLSearchParams(window.location.search);
                    const returnUrl = urlParams.get('returnUrl') || '/admin/albums';
                    window.location.href = returnUrl;
                } else {
                    alert(result.message || '作成に失敗しました');
                }
            } catch (error) {
                console.error('Error:', error);
                alert(error.message || '作成に失敗しました');
            }
        };
    </script>
</body>
</html> 